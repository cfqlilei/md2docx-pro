# 目录规范化总结

## 概述

本文档总结了 md2docx-pro 项目的目录结构规范化工作。通过将源代码、编译产物、测试文件、中间文件等分开存放，提高了项目的组织性和可维护性。

## 规范化后的目录结构

```
md2docx-pro/
├── cmd/                        # Go 命令行程序（源代码）
├── internal/                   # Go 内部包（源代码）
├── pkg/                        # Go 公共包（源代码）
├── qt-frontend/                # Qt 前端源代码
│   ├── src/                    # Qt 源文件
│   ├── ui/                     # Qt UI 文件
│   ├── resources/              # Qt 资源文件
│   └── *.pro                   # Qt 项目文件
├── web/                        # Web 资源（源代码）
│
├── build/                      # 编译产物和中间文件
│   ├── bin/                    # 最终的二进制文件
│   │   ├── md2docx-server      # macOS Go 后端
│   │   ├── md2docx-server.exe  # Windows Go 后端
│   │   ├── md2docx_simple_integrated.app/  # macOS 应用包
│   │   └── md2docx_simple_integrated.exe   # Windows 应用
│   │
│   ├── intermediate/           # 中间文件
│   │   ├── go/                 # Go 编译中间文件
│   │   └── qt/                 # Qt 编译中间文件
│   │       ├── simple_integrated/
│   │       ├── integrated/
│   │       ├── app/
│   │       └── ...
│   │
│   └── release/                # 发布版本（保留用于兼容性）
│
├── dist/                       # 分发文件（可选）
│   ├── macos/                  # macOS 分发包
│   └── windows/                # Windows 分发包
│
├── tests/                      # 测试相关
│   ├── unit/                   # 单元测试
│   ├── integration/            # 集成测试
│   ├── e2e/                    # 端到端测试
│   ├── testdata/               # 测试数据
│   ├── results/                # 测试结果
│   └── utils/                  # 测试工具
│
├── scripts/                    # 构建和部署脚本
│   ├── compile_integrated.sh
│   ├── compile_integrated_windows.bat
│   ├── build_integrated.sh
│   ├── build_integrated_windows.bat
│   ├── clean_integrated.sh
│   ├── clean_integrated_windows.bat
│   ├── verify_directory_structure.sh
│   └── verify_directory_structure.bat
│
├── docs/                       # 文档
│   ├── 开发文档/
│   ├── API文档/
│   └── 测试文档/
│
├── VERSION                     # 版本号文件
├── go.mod, go.sum              # Go 模块文件
├── README.md                   # 项目说明
└── LICENSE                     # 许可证
```

## 主要变更

### 1. Qt 项目文件配置修改

所有 Qt .pro 文件已更新，将编译产物和中间文件输出到统一的 build 目录结构：

**修改的文件：**
- `qt-frontend/md2docx_simple_integrated.pro`
- `qt-frontend/md2docx_integrated.pro`
- `qt-frontend/md2docx_app.pro`
- `qt-frontend/md2docx_simple.pro`
- `qt-frontend/md2docx.pro`
- `qt-frontend/simple_complete.pro`
- `qt-frontend/complete_test.pro`
- `qt-frontend/single_test.pro`

**变更内容：**
```qmake
# 原来的配置
DESTDIR = build_simple_integrated/release
OBJECTS_DIR = build_simple_integrated/release/obj

# 新的配置
DESTDIR = $$PWD/../build/bin
OBJECTS_DIR = $$PWD/../build/intermediate/qt/simple_integrated/release/obj
MOC_DIR = $$PWD/../build/intermediate/qt/simple_integrated/release/moc
RCC_DIR = $$PWD/../build/intermediate/qt/simple_integrated/release/rcc
UI_DIR = $$PWD/../build/intermediate/qt/simple_integrated/release/ui
```

### 2. Mac 构建脚本修改

**修改的文件：**
- `scripts/compile_integrated.sh`
- `scripts/clean_integrated.sh`

**主要变更：**
- Go 后端编译输出到 `build/bin/md2docx-server` 和 `build/bin/md2docx-server.exe`
- Qt 中间文件输出到 `build/intermediate/qt/`
- 清理脚本更新为创建新的目录结构

### 3. Windows 构建脚本修改

**修改的文件：**
- `scripts/compile_integrated_windows.bat`
- `scripts/clean_integrated_windows.bat`

**主要变更：**
- 同 Mac 脚本，确保 Windows 和 Mac 使用相同的目录结构

### 4. 新增验证脚本

**新增文件：**
- `scripts/verify_directory_structure.sh` - Mac 验证脚本
- `scripts/verify_directory_structure.bat` - Windows 验证脚本

这些脚本可以验证目录结构是否符合规范。

## 目录规范说明

### build/bin/ - 最终的二进制文件
存放所有编译后的可执行文件和应用包：
- `md2docx-server` - macOS Go 后端
- `md2docx-server.exe` - Windows Go 后端
- `md2docx_simple_integrated.app/` - macOS 整合版应用包
- `md2docx_simple_integrated.exe` - Windows 整合版应用

### build/intermediate/go/ - Go 编译中间文件
存放 Go 编译过程中的临时文件。

### build/intermediate/qt/ - Qt 编译中间文件
按项目名称分类存放 Qt 编译中间文件：
- `simple_integrated/` - 简单整合版
- `integrated/` - 整合版
- `app/` - 应用版
- 等等

每个项目下有 `debug/` 和 `release/` 两个子目录，分别包含：
- `obj/` - 对象文件
- `moc/` - Qt Meta-Object Compiler 生成的文件
- `rcc/` - 资源编译文件
- `ui/` - UI 生成的文件

### tests/ - 测试相关
- `unit/` - 单元测试
- `integration/` - 集成测试
- `e2e/` - 端到端测试
- `testdata/` - 测试数据
- `results/` - 测试执行结果
- `utils/` - 测试工具函数

## 使用说明

### 清理构建文件
```bash
# Mac
./scripts/clean_integrated.sh

# Windows
scripts\clean_integrated_windows.bat
```

### 编译项目
```bash
# Mac
./scripts/compile_integrated.sh

# Windows
scripts\compile_integrated_windows.bat
```

### 验证目录结构
```bash
# Mac
./scripts/verify_directory_structure.sh

# Windows
scripts\verify_directory_structure.bat
```

## 优势

1. **清晰的组织结构** - 源代码、编译产物、测试文件分开存放
2. **易于清理** - 可以轻松删除 build 目录而不影响源代码
3. **便于版本控制** - 可以将 build 目录添加到 .gitignore
4. **跨平台一致性** - Mac 和 Windows 使用相同的目录结构
5. **易于自动化** - 构建脚本可以更容易地定位文件

## 后续工作

1. 更新 CI/CD 流程以使用新的目录结构
2. 更新项目文档中的路径引用
3. 考虑添加更多的验证和检查脚本
4. 定期检查目录结构的一致性

